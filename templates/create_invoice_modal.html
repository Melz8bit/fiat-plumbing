<div class="modal-dialog modal-lg">
    <div class="modal-content">
        <div class="modal-header">
            <h1 class="modal-title fs-5" id="createinstallmentModalLabel">Create Invoice</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form id="createInvoice" name="createInvoice" method="POST">
            {{ invoice_create_form.csrf_token() }}
            <div class="modal-body">
                <h6>Select items:</h6>
                <table class="table">
                    <thead class="text-center">
                        <th></th>
                        <th>#</th>
                        <th>Description</th>
                        <th>Total Amount</th>
                        <th>Billed %</th>
                        <th>Billed Amount</th>
                    </thead>
                    <tbody>
                        {% if installments|length == 0 %}
                        <tr>
                            <td class="text-center" colspan="100%">
                                No installments found on this project
                            </td>
                        </tr>
                        {% else %}
                        {% for installment in installments %}
                        {% if installment['installment_status'] == 'Pending' %}
                        <tr class="text-center align-items-center">
                            <td>{{ invoice_create_form.installment_select(
                                id="installmentChk{{ installment['installment_id'] }}",
                                value=installment['installment_id']) }}</td>
                            <td>{{ installment['installment_number'] }}</td>
                            <td>{{ installment['installment_description'] }}</td>
                            <td>{{ "${:,.2f}".format(installment['installment_amount']) }}</td>
                            <td style="width:15%">
                                <div class="input-group input-group-sm">
                                    <input id="installmentBillledPercent{{ installment['installment_id'] }}"
                                        type="number" value="100" class="form-control text-end"
                                        onchange="changeBilledAmount({{installment['installment_id']}}, this.value, {{installment['installment_amount']}});">
                                    <!-- {{ invoice_create_form.billed_percentage(
                                    id="installmentBillledPercent{{ installment['installment_id'] }}",
                                    class="form-control text-end", value="100",
                                    onchange="changeBilledAmount(installmentBillledPercent{{
                                    installment['installment_id'] }})"
                                    ) }} -->
                                    <span class="input-group-text">%</span>
                                </div>
                            </td>
                            <td style="width:20%">
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text">$</span>
                                    <input id="installmentBillledAmount{{ installment['installment_id'] }}"
                                        type="number" value={{installment['installment_amount']}}
                                        class="form-control text-end">
                                    <!-- {{ invoice_create_form.billed_amount(
                                    id="installmentBillledAmount{{ installment['installment_id'] }}",
                                    class="form-control form-control-sm text-end",
                                    value='%0.2f'| format(installment['installment_amount']|float),
                                    ) }} -->
                                </div>
                                <script>
                                    function changeBilledAmount(installmentID, percent, installmentAmount) {
                                        let labelElement = document.getElementById("installmentBillledAmount" + installmentID);
                                        labelElement.value =
                                            parseFloat(installmentAmount * (percent / 100)).toFixed(2);
                                    }
                                </script>
                            </td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                        {% endif %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="999">
                                <div class="input-group mb-3">
                                    <span class="input-group-text">Note</span>
                                    <textarea class="form-control" aria-label="Insert Note"
                                        style="resize: none;"></textarea>
                                </div>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="modal-footer">
                {{ invoice_create_form.create(class="btn btn-primary") }}
            </div>
        </form>
    </div>
</div>